@model IEnumerable<SistemaDenuncias.Models.Denuncia>
@{
    ViewData["Title"] = "Painel Principal";
    Layout = "~/Views/Shared/_UsuarioLayout.cshtml";
}

<div class="user-content-wrapper">
    <h1 class="welcome-header">SEJA BEM VINDO(A), @User.Identity.Name!</h1>

    <a asp-controller="Denuncia" asp-action="LocalizacaoEmTempoReal" style="text-decoration:none; color:inherit;">
        <div class="sos-section">
            <div class="sos-icon">SOS</div>
            <div class="sos-info">
                <h3>Ativar modo SOS</h3>
                <p>Esta função envia um alerta de emergência com sua localização em tempo real para os administradores, permitindo uma resposta rápida e segura.</p>
            </div>
        </div>
    </a>

    <div style="text-align: center; margin-bottom: 40px;">
        <h2 class="section-title">DENÚNCIAS REGISTRADAS</h2>
    </div>

    @if (Model.Any())
    {
        <div class="denuncias-grid">
            @foreach (var item in Model)
            {
                <div class="denuncia-card-pro">
                    <div class="denuncia-card-pro-body">
                        <div class="denuncia-card-pro-header">
                            <h3>@Html.DisplayFor(modelItem => item.TipoDenuncia)</h3>
                        </div>
                        <p>@Html.DisplayFor(modelItem => item.Descricao)</p>
                    </div>
                    <div class="denuncia-card-pro-footer">
                        <div class="card-tags-container">
                            <div class="card-tag"><i class="bi bi-geo-alt"></i><span>@Html.DisplayFor(modelItem => item.Cidade)</span></div>
                            @{
                                var statusClass = "status-analise";
                                if (item.Status == StatusDenuncia.Aberta) { statusClass = "status-aberta"; }
                                else if (item.Status == StatusDenuncia.Fechada) { statusClass = "status-fechada"; }
                            }
                            <div class="card-tag @statusClass"><i class="bi bi-tag"></i><span>@item.Status.ToString()</span></div>
                            <div class="card-tag"><i class="bi bi-calendar-event"></i><span>@item.DataCriacao.ToString("dd-MM-yyyy")</span></div>
                        </div>
                        <div class="protocol-section">
                            <span>@item.Protocolo</span>
                            <button onclick="copyProtocol('@item.Protocolo', this)">Copiar protocolo</button>
                        </div>
                        <a asp-action="Details" asp-route-id="@item.Id" class="btn-visualizar">Visualizar Denúncia</a>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center p-5 bg-white rounded-3">
            <h4>Nenhuma denúncia registrada</h4>
            <p>Você ainda não criou nenhuma denúncia. Clique em "Registrar Denúncia" no menu superior para começar.</p>
        </div>
    }
</div>

@section Scripts {
    <script>
        function copyProtocol(protocol, element) {
            navigator.clipboard.writeText(protocol).then(() => {
                const originalText = element.innerText;
                element.innerText = 'Copiado!';
                element.style.backgroundColor = '#28a745';
                setTimeout(() => {
                    element.innerText = originalText;
                    element.style.backgroundColor = '#6c757d';
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar protocolo: ', err);
                alert('Não foi possível copiar o protocolo.');
            });
        }
    </script>
}